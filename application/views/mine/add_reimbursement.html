<!-- content start -->
<div class="admin-content">
    <div class="am-cf am-padding">
        <div class="am-fl am-cf"><strong class="am-text-primary am-text-lg">创建报销单</strong> / <small>Add reimbursement</small></div>
    </div>
    <hr/>
    <div class="am-g">
        <form class="am-form am-form-horizontal" method="post" action="">
            <table cellpadding="0" cellspacing="0" border="0" id="commItemTable">
                <tr>
                    <th>部门：</th>
                    <td><select data-am-selected="{searchBox: 1, dropUp: 0, btnWidth: '250px'}" id="departmentSelect" name="direct_dept_id">
                    <option value="-1">- 选择部门 -</option>
                    <option value="技术部" >技术部</option>
                    <option value="策划部" >策划部</option>
                    <option value="市场部" >市场部</option>
                    </select></td>
                    <th>制单人：</th>
                    <td><input type="text" name="position" id="applyUserInput"  placeholder="制单人">
                    </td>
                    <th></th>
                    <td><button  type="button" class="am-btn am-btn-primary"  data-am-modal="{target: '#my-alert'}">创建</button></td>
                </tr>
            </table>
        </form>
   </div>
<!--popup-->
    <div class="am-modal am-modal-alert" tabindex="-1" id="my-alert">
        <div class="am-modal-dialog">
            <div class="am-modal-hd">
                <a href="javascript: void(0)" class="am-close am-close-spin" data-am-modal-close>&times;</a>
            </div>
            <div class="am-modal-bd">
                <form class="am-form am-form-horizontal" method="post" action="/my_overtime/save_overtime" id="addBulletinForm">
                    <table cellpadding="0" cellspacing="0" border="0">
                        <tr>
                            <th>费用类型：</th>
                            <td>
                            	<select data-am-selected="{searchBox: 1, dropUp: 0, btnWidth: '250px'}" id="style_id" name="style_id">
                                	<option value="-1">- 选择费用类型 -</option>
                                	{{foreach from=$style_list item=item}}
                                		<option value="{{$item.id}}">{{$item.name}}</option>
                                	{{/foreach}}
                            	</select>
                            </td>
                        </tr>
                        <tr>
                            <th>摘要：</th>
                            <td>
                            	<select data-am-selected="{searchBox: 1, dropUp: 0, btnWidth: '250px'}" id="type_id" name="type_id">
                                	<option value="-1">- 选择摘要 -</option>
                            	</select>
                           	</td>
                        </tr>
                        <tr>
                        	<th>项目：</th>
                            <td><input type="text" name="position" id="project" name="project" placeholder="项目"></td>
                        </tr>
                        <tr>
                            <th>日期：</th>
                           	<td>
                               	<input type="text" class="am-form-field" id="date" name="date" placeholder="日期" data-am-datepicker readonly required value="{{$today}}"/>
                           	</td>
                        </tr>
                        <tr>
                            <th>金额：</th>
                            <td><input type="text" name="amount" id="amount"  placeholder="金额"></td>
                        </tr>
                        <tr>
                            <th></th>
                            <td>
                            	<input type="button" class="am-btn am-btn-primary" value="添加" id="btnConfirm">
                            	<input type="button" class="am-btn" value="关闭" id="btnClose">
                            </td>
                        </tr>
                    </table>
                </form>
            </div>
        </div>
    </div>
    <div class="am-g">
        <div class="am-u-sm-12">
            <table class="am-table am-table-striped am-table-hover table-main reimbursement-table" id="add-reimbursement-table">
                <thead>
                <tr>
                    <th class="table-id">项目</th>
                    <th class="table-time">日期</th>
                    <th class="table-freestyle">费用类型</th>
                    <th class="table-abstract">摘要</th>
                    <th class="table-money">金额</th>
                    <th class="table-option">操作</th>
                </tr>
                </thead>
                <tbody>
                	{{foreach from=$expense_list item=item}}
                    <tr>
                       <td>{{$item.project}}</td>
                       <td>{{$item.date}}</td>
                       <td>{{$item.style_id}}</td>
                       <td>{{$item.type_id}}</td>
                       <td>{{$item.amount}}</td>
                       <td>
                       	<button class="am-btn am-btn-default am-btn-xs am-text-danger btn_del" onclick="delete_reimbursement(this);"><span class="am-icon-trash-o"></span> 删除</button>
                        <button type="button"class="am-btn am-btn-default am-btn-xs am-text-secondary" onclick="view_reimbursement(this);"><span class="am-icon-pencil-square-o"></span>编辑</button>
                       </td>
                    </tr>
                    {{/foreach}}
                </tbody>
            </table>
        </div>
    </div>
    <div class="am-g">
        <div class="am-u-sm-12">
           <p class="am-cost-total"> 总计：￥<span class="total"></span></p>
        </div>
    </div>
</div>

<script type="text/javascript">
	var today = '{{$today}}';
	
	function showAlert(message) {
		easyDialog.open({ container: { content: message }, autoClose: 1200 });
	}
	
	$(function() {
		$("#style_id").change(function() {
			var style_id = $(this).val();
			$.get('/my_reimbursement/get_reimbursement_type_list/' + style_id, function(data) {
				var html = '<option value="-1">- 选择摘要 -</option>';
				var data = JSON.parse(data);
				for(var i in data) {
					html += '<option value="' + data[i].id + '">' + data[i].name + '</option>';
				}
				$("#type_id").html(html);
			});
		});
		
		$("#btnConfirm").click(function() {
			clear_popup_items();
			
			var style_id = $("#style_id").val();
	        if (style_id < 0) {
	            showAlert("请选择费用类型！");
	            return;
	        }
	        
	        var type_id = $("#type_id").val();
	        if (type_id < 0) {
	            showAlert("请选择摘要！");
	            return;
	        }
	        
	        var project = $("#project").val();
			if (!project) {
				showAlert("项目不能为空！");
				return false;
			}
			
			var date = $("#date").val();
			if (!date) {
				showAlert("日期不能为空！");
				return false;
			}
	        
	        var amount = $("#amount").val();
			if (!amount) {
				showAlert("金额不能为空！");
				return false;
			}
			
			var html = "<tr>";
			html += "<td>" + project + "</td>";
			html += "<td>" + date + "</td>";
			html += "<td>" + $("#style_id").find("option:selected").text() + "</td>";
			html += "<td>" + $("#type_id").find("option:selected").text() + "</td>";
			html += "<td>" + amount + "</td>";
			html += "<td>";
			html += "<button class='am-btn am-btn-default am-btn-xs am-text-danger btn_del' onclick='delete_reimbursement(this);'><span class='am-icon-trash-o'></span> 删除</button>";
			html += "<button class='am-btn am-btn-default am-btn-xs am-text-secondary' onclick='view_reimbursement(this);'><span class='am-icon-pencil-square-o'></span> 编辑</button>";
			html += "</td>";
			$("#add-reimbursement-table tbody").append(html);
			
			$("#my-alert").modal('close');
		});
		
		$("#btnClose").click(function() {
			$("#my-alert").modal('close');
		});
	});
	
	function clear_popup_items() {
		$("#style_id").val(-1);
		$("#type_id").val(-1);
		$("#project").val('');
		$("#date").val(today);
		$("#amount").val('');
	}
	
	function view_reimbursement(obj) {
		alert(obj);
	}
	
	function delete_reimbursement(obj) {
		$(obj).parent().parent().remove();
	}
</script>
<!-- content end -->